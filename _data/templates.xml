<?xml version="1.0" encoding="utf-8"?>
<templates>
  <template type="admin" title="option_template_CMTV_Math_renderPositions" version_id="2010070" version_string="2.1.0"><![CDATA[<xf:radiorow name="{$inputName}[where]"
			 label="{$option.title}"
			 hint="{$hintHtml}"
			 explain="{$explainHtml}"
			 html="{$listedHtml}">

	<xf:option value="everywhere" selected="$option.option_value.where == 'everywhere'"
			   label="{{ phrase('everywhere') }}" hint="{{ phrase('CMTV_Math_render_everywhere_hint') }}" />

	<xf:option value="positions" selected="$option.option_value.where == 'positions'" label="{{ phrase('CMTV_Math_in_certain_positions') }}">
		<xf:checkbox>
			<xf:option name="{$inputName}[positions][titles]" label="{{ phrase('CMTV_Math_position_titles') }}" checked="{$option.option_value.positions.titles}" />
			<xf:option name="{$inputName}[positions][content]" label="{{ phrase('CMTV_Math_position_content') }}" checked="{$option.option_value.positions.content}" />
			<xf:option name="{$inputName}[positions][pages]" label="{{ phrase('pages') }}" checked="{$option.option_value.positions.pages}" />
			<xf:option name="{$inputName}[positions][signatures]" label="{{ phrase('CMTV_Math_position_signatures') }}" checked="{$option.option_value.positions.signatures}" />
			<xf:option name="{$inputName}[positions][about]" label="{{ phrase('about') }}" checked="{$option.option_value.positions.about}" />
		</xf:checkbox>
	</xf:option>
</xf:radiorow>]]></template>
  <template type="admin" title="option_template_CMTV_Math_selectorsArray" version_id="2010070" version_string="2.1.0"><![CDATA[<xf:formrow rowtype="input"
			label="{$option.title}"
			hint="{$hintHtml}"
			explain="{$explainHtml}"
			html="{$listedHtml}">

	<ul class="listPlain inputGroup-container">
		<xf:foreach loop="$selectors" key="$counter" value="$selector">
			<li class="inputGroup">
				<xf:textbox name="{$inputName}[{$counter}]" value="{$selector}" placeholder="{{ phrase('CMTV_Math_selector') }}" size="20" />
			</li>
		</xf:foreach>

		<li class="inputGroup" data-xf-init="field-adder" data-increment-format="{$inputName}[{counter}]">
			<xf:textbox name="{$inputName}[{$nextCounter}]" placeholder="{{ phrase('CMTV_Math_selector') }}" size="20" />
		</li>
	</ul>
</xf:formrow>]]></template>
  <template type="public" title="CMTV_Math.less" version_id="2010070" version_string="2.1.0"><![CDATA[._fadeInOut()
{
	opacity: 0;
	transition: opacity .2s;

	&.showing
	{
		opacity: 1;
	}
}

#editor_math_form
{	
	.preview-loading,
	.preview-container
	{
		._fadeInOut();
	}
	
	.preview-loading
	{
		margin-right: 5px;
	}
	
	.preview-container
	{
		display: flex;
		align-items: center;
		justify-content: center;
		
		min-height: 100px;
		
		.empty, .error
		{
			font-size: 120%;
			color: @xf-textColorMuted;
		}
		
		.preview
		{
			overflow: auto;
		}
	}
	
}

// #############################  MathJax  #############################

#MathJax_MenuFrame
{
	z-index: 10000 !important;
}

.mjx-chtml,
.MathJax_Display, .MathJax,
.MathJax_PHTML, .MathJax_PHTML_Display,
.MathJax_SVG, .MathJax_SVG_Display,
.MathJax_PlainSource, .MathJax_PlainSource_Display,
.MathJax_MathML
{	
	padding-bottom: 5px;
	
	overflow: hidden;
	overflow-x: auto;
	
	&::-webkit-scrollbar 
	{
		width: 7px;
		height: 7px;
	}

	&::-webkit-scrollbar-track 
	{
		background: transparent;
	}

	&::-webkit-scrollbar-thumb 
	{
		background: xf-intensify(@xf-textColorMuted, -20%);
		
		&:hover
		{
			background: xf-intensify(@xf-textColorMuted, -10%);
		}
		
		&:active
		{
			background: @xf-textColorMuted;
		}
	}
}]]></template>
  <template type="public" title="CMTV_Math_MathJax" version_id="2010070" version_string="2.1.0"><![CDATA[<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  	// CMTV_Math_MathJax_CONFIG_START
    
	tex2jax: {
		processClass: 	"mathjax-proceed",
		ignoreClass:	"mathjax-skip"
	},
	asciimath2jax: {
		processClass: 	"mathjax-proceed",
		ignoreClass:	"mathjax-skip"
	},
	
  	showMathMenu:  {$xf.options.CMTV_Math_mathjax_showMathMenu},
  	messageStyle: "{$xf.options.CMTV_Math_mathjax_messageStyle}",
	displayAlign: "{$xf.options.CMTV_Math_mathjax_displayAlign}",
	
	// CMTV_Math_MathJax_CONFIG_END
  });
</script>

<script class="js-CMTV_Math_renderOptions" type="application/json">{$xf.options.CMTV_Math_renderPositions|json|raw}</script>
<script class="js-CMTV_Math_customRenderSelectors" type="application/json">{$xf.options.CMTV_Math_renderSelectors|json|raw}</script>
<script class="js-CMTV_Math_customSkipSelectors" type="application/json">{$xf.options.CMTV_Math_skipSelectors|json|raw}</script>

<script class="js-CMTV_Math_predefinedSelectors" type="application/json">
	{
		"titles": [
			".p-title-value",
			".contentRow-title",
			".p-body-sidebar .contentRow-main > a",
			".resourceSidebarList .contentRow-main > a",
			".node-extra-title",
			".structItem-title"
		],
		
		"content": [
			".message-body",
			".contentRow-snippet",
			".tooltip-content",
			".resourceBody-main",
			".structItem-resourceTagLine",
			".bbCodePreview-content",
			".comment-body",
			"[data-widget-definition='new_profile_posts'] .contentRow-faderContent"
		],
		
		"pages": [
			"[data-template='help_page'] .p-body-pageContent",
			"[data-template='help_page'] .p-body-sideNavContent",
			"[data-template='help_index'] .p-body-pageContent",
			"[data-template='help_index'] .p-body-sideNavContent"
		],
		
		"signatures": [
			".message-signature",
			"[data-template=member_view] .block-row:contains({{ phrase('signature') }})"
		],
		
		"about": [
			"[data-template=member_view] .block-row:first-of-type"
		],
		
		"skipDefault": [
			".bbCodeBlock",
			".bbCodeInline",
			".fr-box"
		]
	}
</script>

<xf:js prod="CMTV/Math/selector-resolver.min.js" dev="CMTV/Math/selector-resolver.js" addon="CMTV/Math" />
<script>CMTV_Math.SResolver.resolve();</script>

<xf:js prod="CMTV/Math/core.extend.min.js" dev="CMTV/Math/core.extend.js" addon="CMTV/Math" />

<xf:set var="$config" value="" />

<xf:if is="$xf.options.CMTV_Math_mathjax_configuration">
	<xf:set var="$config" value="?config={$xf.options.CMTV_Math_mathjax_configuration}" />
</xf:if>

<xf:set var="$locale">{{ $xf.language.language_code|substr(0, 2) }}</xf:set>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js{$config}&locale={$locale}" async></script>]]></template>
  <template type="public" title="CMTV_Math_editor_dialog_math" version_id="2010070" version_string="2.1.0"><![CDATA[<xf:title>{{ phrase('CMTV_Math_insert_math') }}</xf:title>

<xf:js prod="CMTV/Math/insert-math-form.min.js" dev="CMTV/Math/insert-math-form.js" addon="CMTV/Math" />

<form class="block" id="editor_math_form" data-xf-init="insert-math-form">
	<div class="block-container">
		<div class="block-body">
			<xf:radiorow name="math_type" label="{{ phrase('CMTV_Math_type') }}" explain="{{ phrase('CMTV_Math_type_explain') }}">
				<xf:option value="block" checked="checked" label="{{ phrase('CMTV_Math_block') }}" />
				<xf:option value="inline" label="{{ phrase('CMTV_Math_inline') }}" />
			</xf:radiorow>
			
			<xf:textarearow name="latex_input" rows="2" autosize="true" autofocus="1"
							label="{{ phrase('CMTV_Math_latex_input') }}" explain="{{ phrase('CMTV_Math_latex_input_explain') }}" />
		
			<h2 class="block-formSectionHeader">
				<span class="block-formSectionHeader-aligner">
					<span class="preview-loading"><xf:fa icon="fa-sync-alt fa-spin" /></span>
					{{ phrase('CMTV_Math_preview') }}
				</span>
			</h2>
			
			<div class="preview-container showing">
				<div class="preview">Preview</div>
				<div class="error">{{ phrase('CMTV_Math_incorrect_latex_input') }}</div>
				<div class="empty">{{ phrase('CMTV_Math_start_typing_math') }}</div>
			</div>
		</div>
		
		<xf:submitrow submit="{{ phrase('continue') }}" id="editor_math_submit" />
	</div>
</form>]]></template>
</templates>
